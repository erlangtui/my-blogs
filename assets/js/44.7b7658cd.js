(window.webpackJsonp=window.webpackJsonp||[]).push([[44],{372:function(a,s,t){"use strict";t.r(s);var e=t(4),r=Object(e.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h2",{attrs:{id:"一、api-分类"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#一、api-分类"}},[a._v("#")]),a._v(" 一、API 分类")]),a._v(" "),s("div",{staticClass:"custom-block warning"},[s("p",{staticClass:"custom-block-title"},[a._v("注意")]),a._v(" "),s("ol",[s("li",[a._v("Catalog API：用于查询服务实例、健康检查、节点信息等。")]),a._v(" "),s("li",[a._v("Health API：用于查询所有服务的健康状态。")]),a._v(" "),s("li",[a._v("KV API：用于存储和检索键值对数据。")]),a._v(" "),s("li",[a._v("Agent API：用于配置 Consul 代理的参数，例如数据中心、健康检查间隔、服务注册等。")]),a._v(" "),s("li",[a._v("Event API：用于创建、监听、处理事件。")]),a._v(" "),s("li",[a._v("Snapshot API：用于创建、恢复快照以及将数据迁移到另一个 Consul 群集。")])])]),a._v(" "),s("h2",{attrs:{id:"二、api-具体用法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#二、api-具体用法"}},[a._v("#")]),a._v(" 二、API 具体用法")]),a._v(" "),s("h3",{attrs:{id:"_1-agent-api"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-agent-api"}},[a._v("#")]),a._v(" 1，Agent API")]),a._v(" "),s("div",{staticClass:"language-sh line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 检索主机信息，包括内存、CPU、主机、磁盘信息")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--location")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--request")]),a._v(" GET "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'http://127.0.0.1:8500/v1/agent/host'")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 列出主机成员")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--location")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--request")]),a._v(" GET "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'http://127.0.0.1:8500/v1/agent/members'")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 读取主机的配置")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--location")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--request")]),a._v(" GET "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'http://127.0.0.1:8500/v1/agent/self'")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 重启代理")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--location")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--request")]),a._v(" PUT "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'/v1/agent/reload'")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 查看指标，包括仪表盘、点、计数、样本指标")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--location")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--request")]),a._v(" GET "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'http://127.0.0.1:8500/v1/agent/metrics'")]),a._v(" \n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 查看流日志")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--location")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--request")]),a._v(" GET "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'http://127.0.0.1:8500/v1/agent/monitor'")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 加入代理集群")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--location")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--request")]),a._v(" PUT "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'http://127.0.0.1:8500/v1/agent/join/:address'")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 离开代理集群")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--location")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--request")]),a._v(" PUT "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'http://127.0.0.1:8500/v1/agent/leave'")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 返回注册的所有检查")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--location")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--request")]),a._v(" GET "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'http://127.0.0.1:8500/v1/agent/check'")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 返回向本地代理注册的所有服务")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--location")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--request")]),a._v(" GET "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'http://127.0.0.1:8500/v1/agent/services'")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 获取单个服务实例的完整服务定义")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--location")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--request")]),a._v(" GET "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'http://127.0.0.1:8500/v1/agent/service/:service_id'")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 按名称检索本地代理上的聚合服务状态")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--location")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--request")]),a._v(" GET "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'http://127.0.0.1:8500/v1/agent/health/service/name/:service_name'")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 按id检索本地代理上的聚合服务状态")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--location")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--request")]),a._v(" GET "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'http://127.0.0.1:8500/v1/agent/health/service/id/:service_id'")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 重要，从本地代理解注册服务")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--location")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--request")]),a._v(" PUT "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'http://127.0.0.1:8500/v1/agent/service/deregister/:service_id'")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-H")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"X-Consul-Token: b8fc-a1d6-4d8a-68a8-9a71"')]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 重要，向本地代理注册服务")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--location")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--request")]),a._v(" PUT "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'http://127.0.0.1:8500/v1/agent/service/register'")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-H")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"X-Consul-Token: b8fc-a1d6-4d8a-68a8-9a71"')]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--header")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'Content-Type: application/json'")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--data")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('\'{"ID":"redis1","Name":"redis","Tags":["primary","v1"],"Address":"127.0.0.1","Port":8000,"Meta":{"redis_version":"4.0"},"EnableTagOverride":false,"Check":{"DeregisterCriticalServiceAfter":"90m","Args":["/usr/local/bin/check_redis.py"],"Interval":"10s","Timeout":"5s"},"Weights":{"Passing":10,"Warning":1}}\'')]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br"),s("span",{staticClass:"line-number"},[a._v("14")]),s("br"),s("span",{staticClass:"line-number"},[a._v("15")]),s("br"),s("span",{staticClass:"line-number"},[a._v("16")]),s("br"),s("span",{staticClass:"line-number"},[a._v("17")]),s("br"),s("span",{staticClass:"line-number"},[a._v("18")]),s("br"),s("span",{staticClass:"line-number"},[a._v("19")]),s("br"),s("span",{staticClass:"line-number"},[a._v("20")]),s("br"),s("span",{staticClass:"line-number"},[a._v("21")]),s("br"),s("span",{staticClass:"line-number"},[a._v("22")]),s("br"),s("span",{staticClass:"line-number"},[a._v("23")]),s("br"),s("span",{staticClass:"line-number"},[a._v("24")]),s("br"),s("span",{staticClass:"line-number"},[a._v("25")]),s("br"),s("span",{staticClass:"line-number"},[a._v("26")]),s("br"),s("span",{staticClass:"line-number"},[a._v("27")]),s("br"),s("span",{staticClass:"line-number"},[a._v("28")]),s("br"),s("span",{staticClass:"line-number"},[a._v("29")]),s("br"),s("span",{staticClass:"line-number"},[a._v("30")]),s("br")])]),s("h3",{attrs:{id:"_2-health-api"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-health-api"}},[a._v("#")]),a._v(" 2，Health API")]),a._v(" "),s("div",{staticClass:"language-sh line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 返回特定于节点的检查")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--location")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--request")]),a._v(" GET "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'http://127.0.0.1:8500/v1/health/node/:node'")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 返回提供服务的检查")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--location")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--request")]),a._v(" GET "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'http://127.0.0.1:8500/v1/health/checks/:service'")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 返回提供服务的服务实例")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--location")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--request")]),a._v(" GET "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'http://127.0.0.1:8500/v1/health/service/:service'")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 返回启用连接服务的服务实例")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--location")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--request")]),a._v(" GET "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'http://127.0.0.1:8500/v1/health/connect/:service'")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 返回状态中的检查，state: any,passing, warning,critical")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--location")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--request")]),a._v(" GET "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'http://127.0.0.1:8500/v1/health/state/:state'")]),a._v("\n\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br")])]),s("blockquote",[s("p",[a._v("未完待续……")])])])}),[],!1,null,null,null);s.default=r.exports}}]);