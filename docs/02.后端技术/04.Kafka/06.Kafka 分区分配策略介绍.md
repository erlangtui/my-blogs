---
title: Kafka 分区分配策略介绍
date: 2024-08-10 18:08:25
permalink: /pages/aef660/
categories:
  - 后端技术
  - Kafka
tags:
  - Kafka
author: 
  name: erlangtui
  link: https://github.com/erlangtui
---

## 一、基本介绍
* kafka 同一个 topic 可以设置多个分区，每个分区又可以分布在不同的节点，以实现高可用。同一个消费者组里面可以有多个消费者客户端，对于某个topic的某个分区在某个时刻只能被消费者组里的某一个消费者客户端消费，不能同时被同一个消费者组里面的多个消费者客户端消费。
* 同一个消费者组里的消费者客户端与同一个 topic 下的分区形成了多对多的关系，就需要某种分区分配策略将不同分区分配给不同的消费者客户端消费，下面将介绍客户端支持的常见的三种分配策略。

## 二、范围分配

RangeAssignor 分配策略的原理是按照消费者总数和分区总数进行
整除运算来获得一个跨度，然后将分区按照跨度进行平均分配，以保证
分区尽可能均匀地分配给所有的消费者。对于每一个主题，
RangeAssignor策略会将消费组内所有订阅这个主题的消费者按照名称的
字典序排序，然后为每个消费者划分固定的分区范围，如果不够平均分
配，那么字典序靠前的消费者会被多分配一个分区。
假设n=分区数/消费者数量，m=分区数%消费者数量，那么前m个
消费者每个分配n+1个分区，后面的（消费者数量-m）个消费者每个分
配n个分区。
除了第3.1节的示例，为了更加通俗地讲解RangeAssignor策略，我
们不妨再举一些示例。假设消费组内有2个消费者C0和C1，都订阅了主
题t0和t1，并且每个主题都有4个分区，那么订阅的所有分区可以标识
为：t0p0、t0p1、t0p2、t0p3、t1p0、t1p1、t1p2、t1p3。最终的分配结
果为：
这样分配得很均匀，那么这个分配策略能够一直保持这种良好的特
性吗？我们不妨再来看另一种情况。假设上面例子中2个主题都只有3个
分区，那么订阅的所有分区可以标识为：t0p0、

t0p1、t0p2、t1p0、
t1p1、t1p2。最终的分配结果为：
可以明显地看到这样的分配并不均匀，如果将类似的情形扩大，则
有可能出现部分消费者过载的情况。对此我们再来看另一种
RoundRobinAssignor策略的分配效果如何。
## 三、轮询分配

## 四、保留分配

