---
title: TCP长连接上的请求数控制
date: 2024-05-23 15:49:13
permalink: /pages/d4e137/
categories:
  - 语言
  - Go
tags:
  - 
author: 
  name: erlangtui
  link: https://github.com/erlangtui
---
## 背景

* 背景：四层转发请求时，只有在新建连接时才会触发再均衡策略，导致请求idx的qps极其不均匀。idx服务记录每个长连接的请求数量，并主动关闭长连接，以触发四层的再均衡；

* 进度：已上线，不同机器的qps比较均匀，符合预期。上线前：平均耗时: 76，P99耗时: 133，失败率: 0.000015；上线后：平均耗时: 77，P99耗时: 139，失败率: 0.000005；

netstat -antp | grep goidx | grep :8800 |

ss -n -t -o state established '( sport = :8800 )'

tcpdump src port 8800 -A | grep Connection

## 基本介绍
